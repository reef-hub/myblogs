
# 生产者-消费者问题

 > 经典的进程互斥同步问题

 系统中有2个进程：生产者和消费者，两者共享一个初始为空， 大小为n的缓冲区。生产者进程每次生产一个产品放入缓冲区，消费者每次从缓冲区中取出一个产品并使用。

 缓冲区是临界资源，各进程必须互斥地访问。

 ![生产者消费者问题](/operating_system/pictures/生产者消费者.png)

### PV操作题目分析步骤：

 - 1、关系分析。找出各个进程，分析其之间的同步、互斥关系。
 - 2、整理思路。根据各进程的操作流程确定P、V操作的大致顺序。
 - 3、设置信号量。设置需要的信号量，并根据题目条件确定信号量初值。（互斥信号量初值一般为1，同步信号量初值由对应资源的初始值为多少来决定）

解： 
```cpp
semaphore mutex = 1; //互斥信号量，实现对缓冲区的互斥访问
semaphore empty = n; //同步信号量，表示空闲缓冲区的数量
semaphore full = 0;  //同步信号量，表示产品的数量，也即非空缓冲区的数量

producer() {
    while(1) {
        生产一个产品；
        P(empty);//消耗一个空闲缓冲区
        P(mutex);//互斥
        把产品放入缓冲区；
        V(mutex);//互斥
        V(full);//增加一个产品
    }
}

consumer() {
    while(1) {
        P(full);//消耗一个产品
        P(mutex);
        从缓冲区中取出一个产品；
        V(mutex);
        V(empty);//增加一个空闲缓冲区
    }
}
```
