# 管程（monitor）-封装思想

管程为一种高级同步机制，作用和PV操作一致，用于实现进程的互斥与同步。

但PV操作冗杂，为了简化步骤，更方便地进行进程互斥以及同步，利用管程机制，添加数据结构与过程。

将临界资源化为数据结构，过程即是相应的类成员函数，可对临界资源进行操作。

由编译器负责实现各进程互斥地进入管程中的过程。

> 条件变量（condition）用来实现同步（排队） 

1、需要在管程中定义共享数据（如生产者消费者的缓冲器）
2、需要在管程中定义用于访问这些共享数据的“入口”，其实就是函数。
3、只有通过这些特定的入口函数才能访问共享数据。
4、管程中有很多入口，但是每次只开放其中一个入口，并且只能让一个进程或线程进入（如生产者消费者中各进程的互斥关系。这种互斥特性是由编译器负责实现的，程序员不用关心）
5、可在管程中设置**条件变量**及**等待/唤醒操作**以解决同步问题，可以让一个进程或线程在条件变量上等待（此时，该进程应该先释放管程的使用权，也就是让出出口）；可以通过唤醒操作将等待在条件变量上的进程或线程唤醒。

# 思维导图总结

![管程](/operating_system/pictures/管程.png)